<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Job role information</title>
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/css/main.css" />
  </head>
  <body>
    {% include "partials/header.html" %}
    <section class="page-hero">
      <div class="container">
        <p class="eyebrow">Careers</p>
        <h1 class="page-hero__title">{{ role.roleName or "Job role" }}</h1>
        <p class="page-hero__subtitle">{{ role.description or "No description available." }}</p>
      </div>
    </section>
    <div class="container page-section">
      {% if role %}
        <h1>{{ role.roleName }}</h1>
        <p><b>Status:</b> {{ role.status.statusName or "Not specified" }}</p>

        <h2>Overview</h2>
        <p><b>Location:</b> {{ role.location or "Not specified" }}</p>
        <p><b>Capability:</b> {{ role.capability.capabilityName or "Not specified" }}</p>
        <p><b>Band:</b> {{ role.band.bandName or "Not specified" }}</p>
        <p><b>Closing date:</b> {{ role.closingDate or "Not specified" }}</p>
        <p><b>Open positions:</b> {{ role.numberOfOpenPositions or "Not specified" }}</p>

        <h2>Description</h2>
        <p>{{ role.description or "Not specified" }}</p>

        <h2>Responsibilities</h2>
        <p>{{ role.responsibilities or "Not specified" }}</p>

        <h2>Job spec</h2>
        {% if role.sharepointUrl %}
          <p><a href="{{ role.sharepointUrl }}" target="_blank" rel="noopener noreferrer">View job spec (SharePoint)</a></p>
        {% else %}
          <p>Not specified</p>
        {% endif %}

        {% if canApply %}
        <p><a href="/job-roles/{{ role.jobRoleId }}/apply">Apply for this role</a></p>
        {% endif %}

        {% if applicationsPanel.visible %}
        <div class="page-card applications-card">
          <h2>Applications for this role</h2>

          {% if applicationsPanel.success %}
          <p class="application-feedback success">{{ applicationsPanel.success }}</p>
          {% endif %}
          {% if applicationsPanel.error %}
          <p class="application-feedback error">{{ applicationsPanel.error }}</p>
          {% endif %}

          {% if applicationsPanel.items and applicationsPanel.items.length > 0 %}
          <table class="job-roles-table">
            <caption>Applicants for this job role</caption>
            <thead>
              <tr>
                <th scope="col">Applicant</th>
                <th scope="col">Status</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for application in applicationsPanel.items %}
              <tr>
                <td>
                  {% if application.cvUrl %}
                  <a class="table-link" href="/api/applications/cv?applicationId={{ application.applicationId }}" target="_blank" rel="noopener noreferrer">
                    {{ application.applicantName }}
                  </a>

                  {% else %}
                    {{ application.applicantName }}
                  {% endif %}
                </td>
                <td>{{ application.applicationStatus }}</td>
                <td>
                  {% if application.canAssess %}
                  <div class="application-actions">
                    <form action="/job-roles/{{ role.jobRoleId }}/applications/{{ application.applicationId }}/hire" method="post" class="application-action-form" onsubmit="return confirm('Hire this applicant?');">
                      <button type="submit" class="link-button">Hire</button>
                    </form>
                    <form action="/job-roles/{{ role.jobRoleId }}/applications/{{ application.applicationId }}/reject" method="post" class="application-action-form" onsubmit="return confirm('Reject this applicant?');">
                      <button type="submit" class="link-button">Reject</button>
                    </form>
                  </div>
                  {% else %}
                    <span>â€”</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p>No applications found for this role.</p>
          {% endif %}
        </div>
        {% endif %}

        <p><a href="/job-roles">Back to job roles</a></p>
      {% else %}
        <div class="page-card">
          <p>Job role not found.</p>
          <p><a href="/job-roles">Back to job roles</a></p>
        </div>
      {% endif %}
    </div>
  </body>
</html>
